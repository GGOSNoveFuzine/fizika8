<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Flappy Predpone ‚Äî Neon Edition</title>
  <style>
    /* --- STYLING (Hude barve pa to) --- */
    :root{
      --bg:#020617;
      --fg:#f8fafc;
      --accent:#22d3ee;
      --panel:#0f172acc;
      --neon-green:#10b981;
      --neon-red:#ef4444;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:'Segoe UI', system-ui, sans-serif; overflow:hidden;}
    #wrap{position:relative;max-width:900px;margin:0 auto;height:100vh;display:flex;flex-direction:column}
    
    header{display:flex;gap:.5rem;align-items:center;justify-content:space-between;padding:.5rem .75rem;background:#00000066; border-bottom:1px solid #1e293b; z-index: 50;}
    header .title{font-weight:800;letter-spacing:1px; text-transform:uppercase; background:linear-gradient(to right, #22d3ee, #3b82f6); -webkit-background-clip:text; color:transparent;}
    
    #game{flex:1;position:relative; overflow:hidden;}
    canvas{width:100%;height:100%;display:block;}
    
    /* HUD display */
    .hud{position:absolute;left:0;right:0;top:0;display:flex;gap:.5rem;align-items:center;justify-content:space-between;padding:.5rem .75rem;pointer-events:none; z-index:10;}
    .chip{background:var(--panel);backdrop-filter:blur(4px);padding:.4rem .8rem;border-radius:8px;font-weight:600;font-size:.9rem; border:1px solid #334155; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);}
    
    .fuel{display:flex;align-items:center;gap:.5rem}
    .bar{width:140px;height:8px;background:#1e293b;border-radius:99px;overflow:hidden; border:1px solid #334155;}
    .bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#fde047,#10b981); transition: width 0.2s ease-out;}
    
    .target-box { display:flex; flex-direction:column; align-items:center; min-width: 100px; transition: border 0.2s;}
    .target-label { font-size:0.7rem; text-transform:uppercase; color:#94a3b8; letter-spacing:1px;}
    .target-val { font-weight:900; color:#fbbf24; font-size:1.4rem; text-shadow:0 0 10px rgba(251, 191, 36, 0.5); transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);}
    
    /* ANIMACIJE za feedback */
    .pulse-target { animation: pulse-yellow 0.6s ease-in-out; }
    @keyframes pulse-yellow {
      0% { transform: scale(1); color:#fbbf24; }
      50% { transform: scale(1.4); color:#fff; text-shadow:0 0 20px #fbbf24; }
      100% { transform: scale(1); color:#fbbf24; }
    }

    /* Warning animation - RDEƒå ALERT */
    .target-warning { animation: flash-red 0.5s infinite alternate; border: 1px solid #ef4444; }
    @keyframes flash-red {
      0% { background: var(--panel); box-shadow: 0 0 5px red; }
      100% { background: rgba(239, 68, 68, 0.3); box-shadow: 0 0 20px red; }
    }

    .flash-overlay { position:absolute; inset:0; background:white; pointer-events:none; opacity:0; transition: opacity 0.5s; mix-blend-mode: overlay; z-index: 20; }

    .overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;background:#000000aa;color:var(--fg); backdrop-filter:blur(5px); z-index:30;}
    .card{background:#1e293b;padding:1.5rem;border-radius:16px;box-shadow:0 0 40px rgba(34, 211, 238, 0.1);max-width:90%;text-align:center; border:1px solid #334155;}
    
    button{
      appearance:none;border:none;background:var(--accent);color:#0f172a;font-weight:800;padding:.8rem 1.5rem;border-radius:8px;cursor:pointer; font-size:1rem; transition:transform 0.1s, background 0.1s;
      position: relative; z-index: 100;
    }
    button:hover{transform:scale(1.05); box-shadow:0 0 15px var(--accent);}
    button:active{transform:scale(0.95); background:#0891b2;}
    
    .small{font-size:.85rem;opacity:.7}
    .credit{font-size:0.7rem; opacity:0.5; margin-top:1rem;}
  </style>
</head>
<body>
  <div id="wrap">
    <header>
      <div class="title">Flappy Predpone</div>
      <div class="controls">
        <button id="btnMute" style="padding:0.3rem 0.6rem; background:#334155; color:white;" aria-pressed="false" title="Zvok">üîä</button>
      </div>
    </header>
    
    <div id="game">
      <canvas id="canvas"></canvas>
      <div id="flashFx" class="flash-overlay"></div>

      <div class="hud">
        <div class="chip">DIST: <b id="dist" style="color:#fff">0 m</b></div>
        <div class="chip target-box" id="targetBox">
          <span class="target-label">I≈°ƒçi</span>
          <span id="target" class="target-val">‚Äî</span>
        </div>
        <div class="chip fuel">
          <span>E</span>
          <div class="bar"><i id="fuelFill"></i></div>
          <span>F</span>
        </div>
      </div>

      <div id="start" class="overlay" role="dialog" aria-modal="true">
        <div class="card">
          <h2 style="margin:.2rem 0; color:#22d3ee">NEON PREDPONE</h2>
          <p>Poi≈°ƒçi kartico, ki ustreza trenutnemu cilju.</p>
          <p class="small">Pravilna = Gorivo. Napaƒçna = Kazen.</p>
          <div style="margin:1rem 0; padding:0.5rem; background:#0f172a; border-radius:8px; border:1px solid #334155;">
             Prvi cilj: <b id="startTarget" style="color:#fbbf24; text-transform: uppercase;">...</b>
          </div>
          <button id="btnStart">ZAƒåNI</button>
          <div class="credit">Music: "Neon Hyperdrive" by Adiutorium (CC0)</div>
        </div>
      </div>

      <div id="gameover" class="overlay" style="display:none" role="dialog" aria-modal="true">
        <div class="card">
          <h2 style="margin:.2rem 0">SISTEM PADEL</h2>
          <p>Prevozil(a) si <b id="finalDist" style="color:#22d3ee; font-size:1.2rem">0 m</b></p>
          <div id="stats" class="small" style="text-align:left;white-space:pre-line;margin-top:1rem; line-height:1.6;"></div>
          <div style="margin-top:1.5rem">
             <button id="btnRestart">PONOVNI ZAGON</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <audio id="bgMusic" loop preload="auto">
    <source src="neon_hyperdrive_by_Adiutorium.mp3" type="audio/mpeg">
  </audio>

  <script>
  /* --- AUDIO SETUP (Hybrid style) --- */
  // 1. MP3 Playlista za vajb
  const bgMusic = document.getElementById('bgMusic');
  
  // 2. SFX Synth (DIY piskanje v brskalniku)
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioContext();
  let muted = false;

  const synth = {
    flap: () => playTone(300, 'triangle', 0.1, -5), // en hiter whoosh
    good: () => { playTone(800, 'sine', 0.1); setTimeout(()=>playTone(1200, 'sine', 0.2), 50); }, // coin sound
    bad:  () => playTone(150, 'sawtooth', 0.3, -10), // error buzz
    // WARNING SOUND: Alarm beep beep beep
    warning: () => {
      if(muted) return;
      const now = audioCtx.currentTime;
      // trije hitri piski
      [0, 0.2, 0.4].forEach(offset => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square'; // bl zoprn zvok, da opazi≈°
        osc.frequency.setValueAtTime(600, now + offset);
        gain.gain.setValueAtTime(0.1, now + offset);
        gain.gain.exponentialRampToValueAtTime(0.001, now + offset + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(now + offset);
        osc.stop(now + offset + 0.15);
      });
    }
  };

  // Helper za piskanje
  function playTone(freq, type, duration, drop=0) {
    if(muted || !audioCtx) return;
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    if(drop) osc.frequency.exponentialRampToValueAtTime(Math.max(10, freq+drop*10), audioCtx.currentTime + duration);
    
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime); 
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
  }

  // Mute button logic - da uti≈°a≈° ƒçe ti gre na ≈æivce
  const btnMute = document.getElementById('btnMute');
  btnMute.addEventListener('click', (e)=>{ 
    e.target.blur(); // da spacebar ne triggera gumba
    muted = !muted; 
    btnMute.textContent = muted ? 'üîá' : 'üîä'; 
    
    // Hendlamo ≈°e background music
    bgMusic.muted = muted;
    if(!muted && running) {
        bgMusic.play().catch(()=>{});
    }
  });

  /* --- SETUP MA≈†INE (Canvas) --- */
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  
  // Fixaj DPI da ne bo blurry na telefonih
  function resizeCanvas(){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0); 
  }
  window.addEventListener('resize', resizeCanvas);

  /* --- KONFIGURACIJA IGRE --- */
  const SPEED = 2.5;         // Hitrost skrolanja
  const GRAVITY = 0.35;      // Kolk dol te vleƒçe
  const FLAP_V = -6.5;       // Kolk gor skoƒçi≈°
  const PIPE_W = 75;         // ≈†irina stebrov
  const PIPE_INTERVAL = 3200;// Na kolk ƒçasa pride nov steber
  const FUEL_MAX = 100;
  const FUEL_DRAIN = 2.5;    // Poƒçasn drain (bolj easy)
  const FUEL_HIT_GOOD = 25;  // Nagrada
  const FUEL_HIT_BAD = 15;   // Kazen
  const PIPE_GAP_RATIO = 0.36; // Luknja med stebri
  const GOAL_DURATION_MS = 15000; // Menjava cilja na 15s

  const COLORS = {
    bg: '#020617',
    pipe: '#1e293b',
    pipeGlow: '#22d3ee',
    cardNeutral: '#6366f1',
    good: '#10b981',
    bad: '#ef4444'
  };

  // Vsi prefixi k jih mamo na lagerju
  const PREFIXES = [
    { name:'kilo',  pow:3,  forms:['1000','10¬≥','k'] },
    { name:'hekto', pow:2,  forms:['100','10¬≤','h'] },
    { name:'deka',  pow:1,  forms:['10','10¬π','da'] },
    { name:'deci',  pow:-1, forms:['0,1','10‚Åª¬π','d'] },
    { name:'centi', pow:-2, forms:['0,01','10‚Åª¬≤','c'] },
    { name:'mili',  pow:-3, forms:['0,001','10‚Åª¬≥','m'] }
  ];

  /* --- STATE SPREMENLJIVKE --- */
  let target = PREFIXES[0];
  let nextGoalAt = 0;
  let warningActive = false; // A trenutno blinka warning?
  let fuel = FUEL_MAX * 0.8;
  let distance = 0;
  let lastPipeAt = 0;
  let running = false;
  let lastTime = 0;

  const player = { x: 120, y: 220, v: 0, r: 15, rotation: 0 };
  const pipes = [];
  const pickups = [];
  const particles = [];
  
  // Dva layerja za parallax efekt
  const bgLayers = [ { speed: 0.2, offset: 0 }, { speed: 1.5, offset: 0 } ];
  
  // Statistika za na konc
  const stats = Object.fromEntries(PREFIXES.map(p=>[p.name,{good:0,bad:0}]));

  /* --- UI REFERENCE --- */
  const distEl = document.getElementById('dist');
  const targetEl = document.getElementById('target');
  const targetBox = document.getElementById('targetBox'); // Za warning border
  const startTargetEl = document.getElementById('startTarget');
  const fuelFillEl = document.getElementById('fuelFill');
  const startOverlay = document.getElementById('start');
  const overOverlay = document.getElementById('gameover');
  const finalDistEl = document.getElementById('finalDist');
  const statsEl = document.getElementById('stats');
  const flashFx = document.getElementById('flashFx');


  /* --- LOGIKA IGRE --- */
  
  // Zamenjaj cilj in resetiraj warninge
  function setNewTarget(){
    let prev = target;
    // Najdi enga novga, da ni isti k prej
    do { target = PREFIXES[Math.floor(Math.random()*PREFIXES.length)]; } while(target===prev && PREFIXES.length>1);
    
    // UI updejti
    targetEl.textContent = `${target.name}`;
    nextGoalAt = performance.now() + GOAL_DURATION_MS;
    
    // Reset warning visualov
    warningActive = false;
    targetBox.classList.remove('target-warning'); 
    
    // Mal pulse animacije da se vid da je switch
    targetEl.parentElement.classList.remove('pulse-target');
    void targetEl.offsetWidth; // trigger reflow hack
    targetEl.parentElement.classList.add('pulse-target');
    
    // Flash ƒçez cel ekran
    flashFx.style.opacity = '0.4'; 
    setTimeout(()=> flashFx.style.opacity = '0', 300);
  }

  // Nared nov steber pa par kartic zraven
  function spawnPipe(){
    const h = canvas.height / (window.devicePixelRatio||1);
    const gap = h * PIPE_GAP_RATIO;
    const minTop = 80, minBottom = 100;
    const gapY = Math.random()*(h-minTop-minBottom-gap) + minTop;
    const margin = 20; 
    pipes.push({ x: (canvas.width/(window.devicePixelRatio||1))+50, topH: gapY });

    // Spawn kartic (pickups)
    const count = 4 + Math.floor(Math.random()*3); 
    const numGood = Math.max(1, Math.round(count * 0.4)); // ene 40% jih je tapravih
    
    // Shuffle logic, da niso vedno na istem mestu
    const order = Array.from({length:count}, (_,i)=> i < numGood);
    for(let i=order.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [order[i],order[j]]=[order[j],order[i]]; }

    const pipeCenterX = pipes[pipes.length-1].x + PIPE_W/2;
    for(let i=0;i<count;i++){
      const shouldBeInitialMatch = order[i];
      let originPrefix;
      
      // A bo taprava al napaƒçna?
      if(shouldBeInitialMatch) originPrefix = target;
      else {
        // Zberi nakljuƒçno napaƒçno
        do { originPrefix = PREFIXES[Math.floor(Math.random()*PREFIXES.length)]; } while(originPrefix===target);
      }
      
      const txt = originPrefix.forms[Math.floor(Math.random()*originPrefix.forms.length)];
      const py = Math.random()*(gap - 2*margin) + (gapY + margin);
      
      pickups.push({ 
        x: pipeCenterX + i*45 + 20, 
        y: py, 
        text: txt, 
        originName: originPrefix.name, 
        baseY: py, 
        offset: Math.random() * Math.PI * 2 // za bobbing animacijo
      });
    }
  }

  // Boom efekt
  function createExplosion(x, y, color){
    for(let i=0; i<12; i++){
      particles.push({ x, y, vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8, life: 1.0, color, size: 3+Math.random()*4 });
    }
  }

  /* --- INPUT HANDLING --- */
  function flap(){
    if(!running) return;
    player.v = FLAP_V;
    synth.flap(); // Zvok!
    // Mal dima iz auspuha
    for(let i=0;i<3;i++){
      particles.push({ x: player.x - 10, y: player.y + (Math.random()-0.5)*10, vx: -2 - Math.random(), vy: (Math.random()-0.5), life: 0.6, color: '#e0f2fe', size: 4 });
    }
  }

  window.addEventListener('keydown', (e)=>{ 
    if(e.code==='Space'){ e.preventDefault(); flap(); } 
    if(e.code==='Enter'){ e.preventDefault(); if(!running) handleStartClick(); }
  });
  canvas.addEventListener('pointerdown', (e)=> { e.preventDefault(); flap(); });

  // ≈†tart gumb logika
  function handleStartClick(e){
    if(e && e.target) e.target.blur(); // Odstrani fokus da enter/space ne klikata gumba
    
    // Unlockaj audio context ƒçe je browser zate≈æil
    if(audioCtx.state === 'suspended') audioCtx.resume();
    
    // ≈†tartaj musko
    bgMusic.currentTime = 0;
    bgMusic.volume = 0.4; // Mal ti≈°je k SFX
    if(!muted) bgMusic.play().catch(e => console.log("Audio play blocked until interaction"));
    
    reset(); start();
  }
  document.getElementById('btnStart').addEventListener('click', handleStartClick);
  document.getElementById('btnRestart').addEventListener('click', handleStartClick);

  /* --- MAIN LOOP (Tle se dogaja magija) --- */
  function reset(){
    resizeCanvas();
    // Reset stats
    for(const k in stats){ stats[k].good = 0; stats[k].bad = 0; }
    
    target = PREFIXES[Math.floor(Math.random()*PREFIXES.length)];
    targetEl.textContent = `${target.name}`;
    startTargetEl.textContent = targetEl.textContent;
    
    // Prvi goal timing
    nextGoalAt = performance.now() + GOAL_DURATION_MS;
    warningActive = false;
    targetBox.classList.remove('target-warning');

    // Player position reset
    player.x = canvas.getBoundingClientRect().width * 0.2 || 100;
    player.y = canvas.getBoundingClientRect().height * 0.45 || 200;
    player.v = 0; player.rotation = 0;
    
    fuel = FUEL_MAX*0.8; // 80% goriva za ≈°tart
    distance = 0; 
    distEl.textContent = '0 m';
    
    pipes.length = 0; pickups.length = 0; particles.length = 0; lastPipeAt = 0;
  }

  function start(){ running = true; startOverlay.style.display='none'; overOverlay.style.display='none'; lastTime=performance.now(); }
  
  function gameOver(){
    running = false; 
    overOverlay.style.display='flex'; 
    finalDistEl.textContent = distEl.textContent;
    
    // Ugasn musko k umre≈°
    bgMusic.pause();

    // Izpis statistike
    const lines = PREFIXES.map(p=>{
      const s = stats[p.name]; const total = s.good + s.bad; if(total===0) return null;
      return `<b>${p.name}</b>: ${s.good}/${total} (${Math.round((s.good/total)*100)}%)`;
    }).filter(Boolean);
    statsEl.innerHTML = lines.length? lines.join('<br>') : 'Ni podatkov.';
  }

  function loop(t){
    const dt = Math.min(50, t - lastTime); lastTime = t;
    const w = canvas.width / (window.devicePixelRatio||1); const h = canvas.height / (window.devicePixelRatio||1);

    if(running){
      // --- LOGIKA ZA MENJAVO PREFIXOV ---
      const timeLeft = nextGoalAt - t;
      
      // ƒåe je cajt potekel, zamenjaj
      if(timeLeft <= 0){
        setNewTarget();
      } 
      // ƒåe je ≈°e manj k 2 sekundi, pri≈ægi alarme!
      else if(timeLeft < 2000 && !warningActive){
        warningActive = true;
        targetBox.classList.add('target-warning'); // visual flash
        synth.warning(); // zvoƒçni beep beep beep
      }

      // --- FUEL LOGIC ---
      fuel -= (FUEL_DRAIN * dt / 1000);
      if(fuel <= 0){ fuel=0; updateFuelBar(); return gameOver(); } // RIP bencin

      // --- PARALLAX BG ---
      bgLayers[0].offset += bgLayers[0].speed; bgLayers[1].offset += bgLayers[1].speed;

      // --- PIPI (Stebri) ---
      if(t - lastPipeAt > PIPE_INTERVAL){ lastPipeAt = t; spawnPipe(); }
      for(const p of pipes) p.x -= SPEED;
      if(pipes.length && pipes[0].x + PIPE_W < -50) pipes.shift(); // Bri≈°i stare

      // --- KARTICE ---
      for(const c of pickups){ c.x -= SPEED; c.y = c.baseY + Math.sin((t/300) + c.offset) * 5; }
      if(pickups.length && pickups[0].x < -100) pickups.shift();

      // --- DELCI (Particles) ---
      for(let i=particles.length-1; i>=0; i--){ const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life-=0.03; p.size*=0.95; if(p.life<=0) particles.splice(i,1); }

      // --- FIZIKA ---
      player.v += GRAVITY; player.y += player.v; player.rotation += 0.15;
      distance += SPEED * (dt/16.67); distEl.textContent = Math.floor(distance/3) + ' m';
      updateFuelBar();

      // --- COLLISIONS (Bum v steno) ---
      if(player.y < 0 || player.y > h) return gameOver(); // Strop/Tla
      
      const gap = h * PIPE_GAP_RATIO;
      for(const p of pipes){
        // Check ƒçe si zadel zgornji al pa spodnji del cevi
        if(inRect(player.x, player.y, p.x+4, 0, PIPE_W-8, p.topH) || inRect(player.x, player.y, p.x+4, p.topH+gap, PIPE_W-8, h-(p.topH+gap))) return gameOver();
      }
      
      // Check ƒçe si pobral kartico
      for(let i=pickups.length-1; i>=0; i--){
        const c = pickups[i];
        // Simple circle-rect collision (mal poenostavljen)
        if(Math.abs(player.x - c.x) < 30 && Math.abs(player.y - c.y) < 25){
          if(c.originName === target.name){
            // YAY
            fuel = Math.min(FUEL_MAX, fuel + FUEL_HIT_GOOD); synth.good(); stats[target.name].good++; createExplosion(c.x, c.y, COLORS.good);
          } else {
            // NAY
            fuel = Math.max(0, fuel - FUEL_HIT_BAD); synth.bad(); stats[target.name].bad++; createExplosion(c.x, c.y, COLORS.bad);
          }
          pickups.splice(i,1); // Odstrani pobrano
        }
      }
    }

    // --- DRAWING (Risanje na ekran) ---
    ctx.fillStyle = COLORS.bg; ctx.fillRect(0,0,w,h);
    
    drawParallax(w, h);
    
    // Stebri
    ctx.shadowBlur = 15; ctx.shadowColor = COLORS.pipeGlow;
    for(const p of pipes){ const gap = h * PIPE_GAP_RATIO; drawNeonPipe(p.x, 0, PIPE_W, p.topH); drawNeonPipe(p.x, p.topH+gap, PIPE_W, h-(p.topH+gap)); }
    ctx.shadowBlur = 0;
    
    // Delci
    for(const p of particles){ ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.rect(p.x, p.y, p.size, p.size); ctx.fill(); }
    ctx.globalAlpha = 1;
    
    // Kartice
    for(const c of pickups) drawHoloCard(c.x, c.y, c.text);
    
    // Igralec
    drawPlayer(player.x, player.y, player.r, player.rotation, player.v);
    
    requestAnimationFrame(loop);
  }

  /* --- RISALNE FUNKCIJE --- */
  function drawParallax(w, h){
    ctx.fillStyle = '#0f172a'; const mOff = bgLayers[0].offset % w;
    ctx.beginPath(); ctx.moveTo(0, h);
    for(let x=0; x<=w; x+=50){ ctx.lineTo(x, h - 100 - Math.sin((x + mOff)*0.01)*50 - Math.sin((x+mOff)*0.03)*20); }
    ctx.lineTo(w, h); ctx.fill();
    ctx.strokeStyle = '#1e293b'; ctx.lineWidth = 2; const gOff = bgLayers[1].offset % 40;
    for(let x = -gOff; x < w; x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
  }
  function drawNeonPipe(x, y, w, h){
    ctx.fillStyle = COLORS.pipe; ctx.strokeStyle = COLORS.pipeGlow; ctx.lineWidth = 2;
    ctx.fillRect(x, y, w, h); ctx.strokeRect(x, y, w, h);
    ctx.save(); ctx.beginPath(); ctx.rect(x,y,w,h); ctx.clip();
    ctx.strokeStyle = '#334155'; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(x+10, y); ctx.lineTo(x+10, y+h); ctx.moveTo(x+w-10, y); ctx.lineTo(x+w-10, y+h); ctx.stroke(); ctx.restore();
  }
  function drawHoloCard(x, y, text){
    const w = 60, h = 36; ctx.save(); ctx.translate(x, y);
    ctx.shadowBlur = 10; ctx.shadowColor = COLORS.cardNeutral;
    ctx.fillStyle = 'rgba(99, 102, 241, 0.15)'; ctx.strokeStyle = COLORS.cardNeutral; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(-w/2 + 5, -h/2); ctx.lineTo(w/2 - 5, -h/2); ctx.lineTo(w/2, 0); ctx.lineTo(w/2 - 5, h/2); ctx.lineTo(-w/2 + 5, h/2); ctx.lineTo(-w/2, 0); ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.shadowBlur = 0; ctx.fillStyle = '#e0e7ff'; ctx.font = '700 15px "Segoe UI", sans-serif';
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(text, 0, 1); ctx.restore();
  }
  function drawPlayer(x, y, r, rot, vy){
    ctx.save(); ctx.translate(x, y);
    const tilt = Math.min(0.5, Math.max(-0.5, vy * 0.08)); ctx.rotate(tilt);
    ctx.shadowBlur = 15; ctx.shadowColor = '#22d3ee';
    ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.strokeStyle = '#22d3ee'; ctx.lineWidth = 3; ctx.stroke(); ctx.fillStyle = '#0f172a'; ctx.fill();
    ctx.shadowBlur = 0; ctx.save(); ctx.rotate(rot); ctx.strokeStyle = '#38bdf8'; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(-r, 0); ctx.lineTo(r, 0); ctx.moveTo(0, -r); ctx.lineTo(0, r); ctx.stroke(); ctx.restore(); ctx.restore();
  }
  function inRect(px,py, rx,ry,rw,rh){ return px>rx && px<rx+rw && py>ry && py<ry+rh; }
  function updateFuelBar(){
    const pct = Math.max(0, Math.min(1, fuel / FUEL_MAX));
    fuelFillEl.style.width = (pct*100) + '%';
    if(pct < 0.25) fuelFillEl.style.background = '#ef4444'; else fuelFillEl.style.background = 'linear-gradient(90deg,#fde047,#10b981)';
  }

  // Dejmo gas!
  reset(); requestAnimationFrame((t)=>{ lastTime=t; loop(t); });
  </script>
</body>
</html>