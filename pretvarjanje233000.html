<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pretvarjanje enot</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 1em;
    }
    select, input, button {
      padding: 0.5em;
      margin: 0.5em 0;
    }
    input[type="text"] {
      width: 50%;
    }
    .rezultat {
      font-weight: bold;
      margin-top: 1em;
      white-space: pre-line;
    }
    .vprasanje {
      margin-bottom: 1em;
    }
    .resitev {
      font-style: italic;
      color: #555;
      margin-top: 0.3em;
    }
  </style>
</head>
<body>
  <h1>Pretvarjanje enot</h1>

  <label for="tipEnote">Izberi vrsto enote:</label>
  <select id="tipEnote" onchange="nastaviNaloge()">
    <option value="masa">Masa</option>
    <option value="dolzina">Dolžina</option>
    <option value="povrsina">Površina</option>
    <option value="prostornina">Prostornina</option>
    <option value="cas">Čas</option>
  </select>

  <label for="tezavnost">Izberi težavnost:</label>
  <select id="tezavnost" onchange="nastaviNaloge()">
    <option value="lahka">Lahka</option>
    <option value="srednja">Srednja</option>
    <option value="tezka">Težka</option>
  </select>

  <div id="naloge"></div>

  <button id="preveriBtn" onclick="preveriOdgovore()" disabled>Preveri</button>
  <button onclick="nastaviNaloge()">Nove naloge</button>

  <div class="rezultat" id="rezultat"></div>

  <script>
    function formatDecimal(val) {
      const fixed = Number(val).toFixed(10).replace(/0+$/, '').replace(/\.$/, '');
      return fixed.replace('.', ',');
    }

    function parseDecimal(val) {
      return parseFloat(val.replace(',', '.'));
    }

    function getConversionFactor(from, to) {
      const conversion = {
        ng: 1e-9, μg: 1e-6, mg: 1e-3, cg: 1e-2, dag: 1e1, g: 1, kg: 1e3, t: 1e6,
        nm: 1e-9, μm: 1e-6, mm: 1e-3, cm: 1e-2, dm: 1e-1, m: 1, km: 1e3,
        "mm²": 1e-6, "cm²": 1e-4, "dm²": 1e-2, "m²": 1, "arov": 100, "ha": 1e4, "km²": 1e6,
        μl: 1e-6, ml: 1e-3, cl: 1e-2, dl: 1e-1, l: 1, hl: 1e2, "cm³": 1e-3, "dm³": 1, "mm³": 1e-6, "m³": 1e3, "km³": 1e12,
        ms: 1e-3, "0.01 s": 0.01, "0.1 s": 0.1, s: 1, min: 60, h: 3600, dni: 86400
      };
      return conversion[from] / conversion[to];
    }

    function pretvoriVrednost(vrednost, from, to, tip) {
      let rezultat = vrednost * getConversionFactor(from, to);
      return formatDecimal(rezultat);
    }

    function getRandomValue(tezavnost) {
      if (tezavnost === "lahka") {
        return Math.floor(Math.random() * 1000) + 1;
      } else if (tezavnost === "srednja") {
        return Math.random() < 0.5 ?
          (Math.random() * 9900 + 100).toFixed(0) :
          (Math.random() * 0.999 + 0.001).toFixed(3);
      } else {
        return Math.random() < 0.5 ?
          (Math.random() * (1000000 - 10000) + 10000).toFixed(0) :
          (Math.random() * 0.9999 + 0.0001).toFixed(4);
      }
    }

    function generateEnote(tip, tezavnost) {
      const enote = {
        masa: {
          lahka: ["mg", "g", "dag", "kg", "t"],
          srednja: ["mg", "cg", "g", "dag", "kg", "t"],
          tezka: ["ng", "μg", "mg", "cg", "g", "dag", "kg", "t"]
        },
        dolzina: {
          lahka: ["mm", "cm", "dm", "m", "km"],
          srednja: ["mm", "cm", "dm", "m", "km"],
          tezka: ["nm", "μm", "mm", "cm", "dm", "m", "km"]
        },
        povrsina: {
          lahka: ["mm²", "cm²", "dm²", "m²"],
          srednja: ["mm²", "cm²", "dm²", "m²", "arov", "ha"],
          tezka: ["mm²", "cm²", "dm²", "m²", "arov", "ha", "km²"]
        },
        prostornina: {
          lahka: ["ml", "cl", "dl", "l", "dm³", "cm³", "m³"],
          srednja: ["ml", "cl", "dl", "l", "hl", "dm³", "cm³", "mm³", "m³"],
          tezka: ["μl", "ml", "cl", "dl", "l", "hl", "dm³", "cm³", "mm³", "m³", "km³"]
        },
        cas: {
          lahka: ["s", "min", "h", "dni"],
          srednja: ["s", "min", "h", "dni"],
          tezka: ["ms", "0.01 s", "0.1 s", "s", "min", "h", "dni"]
        }
      };
      const seznam = enote[tip][tezavnost];
      const pari = [];
      for (let i = 0; i < seznam.length; i++) {
        for (let j = 0; j < seznam.length; j++) {
          if (i !== j) {
            pari.push({ enota: seznam[i], cilj: seznam[j] });
          }
        }
      }
      return pari;
    }

    function nastaviNaloge() {
      const tip = document.getElementById("tipEnote").value;
      const tezavnost = document.getElementById("tezavnost").value;
      const pari = generateEnote(tip, tezavnost);
      const nalogeDiv = document.getElementById("naloge");
      nalogeDiv.innerHTML = "";
      const izbraniPari = [];

      while (izbraniPari.length < 10 && pari.length > 0) {
        const index = Math.floor(Math.random() * pari.length);
        izbraniPari.push(pari.splice(index, 1)[0]);
      }

      izbraniPari.forEach(par => {
        const vrednost = getRandomValue(tezavnost);
        const pravilen = pretvoriVrednost(vrednost, par.enota, par.cilj);
        const div = document.createElement("div");
        div.className = "vprasanje";
        div.innerHTML = `${formatDecimal(vrednost)} ${par.enota} = <input type="text" data-pravilno="${pravilen}" data-enota="${par.cilj}"> ${par.cilj}<div class="resitev"></div>`;
        nalogeDiv.appendChild(div);
      });

      document.getElementById("preveriBtn").disabled = false;
      document.getElementById("rezultat").textContent = "";
    }

    function preveriOdgovore() {
      const vprasanja = document.querySelectorAll('.vprasanje');
      let pravilni = 0;
      vprasanja.forEach(v => {
        const input = v.querySelector('input');
        const resitevDiv = v.querySelector('.resitev');
        const vnos = input.value.trim();

        if (vnos === "") return;

        if (vnos.includes('.') || !/^\d+(,\d+)?$/.test(vnos)) {
          input.style.backgroundColor = '#f7c5c5';
          resitevDiv.textContent = "Vnesi številko z decimalno vejico!";
          return;
        }

        const uporabnikov = parseDecimal(vnos);
        if (isNaN(uporabnikov)) {
          input.style.backgroundColor = '#f7c5c5';
          resitevDiv.textContent = "Vnesi številko z decimalno vejico!";
        } else {
          const pravilen = parseDecimal(input.dataset.pravilno);
          if (Math.abs(uporabnikov - pravilen) < 0.01) {
            input.style.backgroundColor = '#c8f7c5';
            resitevDiv.textContent = "";
            pravilni++;
          } else {
            input.style.backgroundColor = '#f7c5c5';
            resitevDiv.textContent = `Pravilno: ${input.dataset.pravilno} ${input.dataset.enota}`;
          }
        }
      });
      document.getElementById('rezultat').textContent = `Pravilnih odgovorov: ${pravilni} od ${vprasanja.length}`;
    }
  </script>
</body>
</html>
