<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kolo - simulacija </title>
  <style>
    :root{
      --bg:#0f172a;--card:#111827;--muted:#94a3b8;--fg:#e5e7eb;
      --accent:#22d3ee;--accent-2:#60a5fa;--axis:#cbd5e1;--tick:#94a3b8;--good:#34d399;--stop:#ff4d6d
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:radial-gradient(1200px 600px at 10% -10%,#1f2937 0%,var(--bg) 40%);
      color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
      min-height:100svh;display:grid;place-items:start;padding:24px
    }
    .app{
      width:min(1150px,100%);margin-inline:auto;
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,.45);
      padding:22px clamp(16px,3vw,30px)
    }
    h1{margin:0 0 6px 0;font-size:clamp(20px,2.6vw,30px);letter-spacing:.2px}
    .sub{margin:0 0 14px 0;color:var(--muted);font-size:14px}
    .panel{display:grid;grid-template-columns:1fr auto;gap:14px;align-items:center}
    @media (max-width:720px){.panel{grid-template-columns:1fr}}
    .stats{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    .stat{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:10px 12px;text-align:center}
    .stat .label{color:var(--muted);font-size:12px}
    .stat .value{font-size:clamp(18px,2.2vw,22px);font-weight:700;transition:color .2s ease}
    .value.flash{color:var(--good)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    button{appearance:none;border:0;border-radius:14px;padding:10px 14px;font-weight:600;color:#0b1220;
      background:linear-gradient(180deg,var(--accent),var(--accent-2));cursor:pointer;transition:transform .06s ease,filter .2s ease}
    button.secondary{background:#1f2937;color:var(--fg);border:1px solid rgba(255,255,255,.08)}
    button:active{transform:translateY(1px)}
    .grid{display:grid;gap:24px;margin-top:10px}
    @media (min-width:940px){.grid{grid-template-columns:1.2fr .8fr}}
    .stage,.card{background:#0b1220;border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:clamp(10px,2.2vw,16px)}
    .note{margin-top:8px;color:var(--muted);font-size:12px;text-align:center}
    .card h3{margin:0 0 10px 0;font-size:16px;color:#e5e7eb}
    .gwrap{display:grid;gap:28px}
    canvas{width:100%;height:260px;display:block;border-radius:14px;background:#0b1220}
    .legend{position:absolute;inset:auto 10px 8px auto;background:#0b1220aa;padding:6px 8px;border-radius:10px;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,.1)}
    .canWrap{position:relative}

    /* tabela s(t) */
    .tableWrap{margin-top:14px}
    table.data{
      width:100%; border-collapse:separate; border-spacing:0; overflow:hidden;
      border:1px solid rgba(255,255,255,.08); border-radius:14px; background:#0b1220
    }
    .data th,.data td{padding:8px 10px; text-align:right; font-variant-numeric:tabular-nums; }
    .data th{background:#0f1a31; color:#cbd5e1; text-align:right; font-weight:700}
    .data tr:not(:first-child) td{border-top:1px solid rgba(255,255,255,.06)}
    .data td.time{color:#e5e7eb; width:30%}
    .data td.dist{color:#94a3b8}
    .data td.dist.filled{color:#e5e7eb; font-weight:700}
  </style>
</head>
<body>
  <div class="app">
    <h1>Enakomerno gibanje: Kolo - simulacija enakomernega gibanja</h1>
    <p class="sub">Kolo se giblje enakomerno od 0 do D. </p>

    <div class="panel">
      <div class="stats">
        <div class="stat"><div class="label">Razdalja D</div><div class="value" id="dOut">—</div></div>
        <div class="stat"><div class="label">Čas T</div><div class="value" id="tOut">—</div></div>
        <div class="stat"><div class="label">Hitrost v</div><div class="value" id="vOut">—</div></div>
        <div class="stat"><div class="label">t, s (trenutno)</div><div class="value" id="liveOut">—</div></div>
      </div>
      <div class="controls">
        <button id="newBtn">Nova naloga</button>
        <button id="playBtn">Predvajaj</button>
        <button id="pauseBtn" class="secondary">Pavza</button>
        <button id="resetBtn" class="secondary">Ponastavi</button>
      </div>
    </div>

    <div class="grid">
      <!-- Levo: animacija + tabela -->
      <div class="stage">
        <svg id="svg" viewBox="0 0 1000 260" width="100%" height="260" aria-label="Številčna os z animacijo kolesa">
          <g id="axis"></g>

          <!-- ====== BIKE + RIDER (SVG) ====== -->
          <!-- Bike group is translated horizontally during animation -->
          <g id="bike" transform="translate(60,155)">
            <!-- wheels -->
            <circle id="rearWheel" cx="0" cy="0" r="18" fill="#0b1220" stroke="#e2e8f0" stroke-width="3"></circle>
            <circle id="frontWheel" cx="48" cy="0" r="18" fill="#0b1220" stroke="#e2e8f0" stroke-width="3"></circle>

            <!-- frame (diamond-ish) -->
            <g stroke="#60a5fa" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">
              <!-- chainstay + seatstay -->
              <polyline points="0,0 20,0 36,-12 48,0"></polyline>
              <!-- downtube + top tube + seat tube -->
              <polyline points="20,0 10,-16 34,-18 20,0"></polyline>
            </g>

            <!-- handlebar + fork -->
            <g stroke="#60a5fa" stroke-width="3" stroke-linecap="round" fill="none">
              <line x1="45" y1="-18" x2="55" y2="-24"></line> <!-- bar -->
              <line x1="42" y1="-4" x2="45" y2="-18"></line>  <!-- fork -->
            </g>

            <!-- saddle + seatpost -->
            <g stroke="#60a5fa" stroke-width="3" stroke-linecap="round">
              <line x1="18" y1="-18" x2="16" y2="-24"></line>
              <line x1="12" y1="-24" x2="20" y2="-24"></line>
            </g>

            <!-- crank + pedals (rotating) -->
            <!-- bottom bracket center at (20,0) -->
            <g id="crank" transform="rotate(0 20 0)">
              <circle cx="20" cy="0" r="3.2" fill="#60a5fa"></circle>
              <line x1="20" y1="0" x2="28" y2="0" stroke="#60a5fa" stroke-width="3" stroke-linecap="round"></line>
              <line x1="20" y1="0" x2="12" y2="0" stroke="#60a5fa" stroke-width="3" stroke-linecap="round"></line>
            </g>

            <!-- RIDER (simple, readable) -->
            <!-- hip near (18,-18); shoulder near (28,-30); head near (28,-40) -->
            <g stroke="#bcd7ff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" fill="none">
              <!-- torso -->
              <line x1="18" y1="-18" x2="28" y2="-30"></line>
              <!-- arms to handlebar -->
              <line x1="28" y1="-30" x2="52" y2="-24"></line>
              <!-- seat to hip -->
              <line x1="16" y1="-24" x2="18" y2="-18"></line>
              <!-- leading leg (hip->knee->ankle near pedal) -->
              <polyline id="legFront" points="18,-18 24,-10 28,0"></polyline>
              <!-- trailing leg -->
              <polyline id="legBack" points="18,-18 12,-10 12,0"></polyline>
            </g>
            <!-- head -->
            <circle cx="28" cy="-40" r="5.5" fill="#bcd7ff" stroke="#0b1220" stroke-width="1"></circle>
          </g>
        </svg>

        <div class="tableWrap">
          <table class="data" id="dataTable">
            <thead>
              <tr><th style="text-align:right">t [s]</th><th style="text-align:right">s [m]</th></tr>
            </thead>
            <tbody id="dataBody"><!-- polni se dinamično --></tbody>
          </table>
        </div>
        <div class="note"></div>
      </div>

      <!-- Desno: grafi (Chart.js iz LOKALNE datoteke) -->
      <div class="card">
        <h3>Grafi</h3>
        <div class="gwrap">
          <div class="canWrap">
            <canvas id="sChart"></canvas>
            <div class="legend">s(t) – pot</div>
          </div>
          <div class="canWrap">
            <canvas id="vChart"></canvas>
            <div class="legend">v(t) – hitrost</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js naložimo IZ ISTE MAPE (lokalno) -->
  <script src="./chart.min.js"></script>

  <script>
    // ========= Pomožne fore =========
    const rndInt = (a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    const fmt = (n,d=1)=>Number(n).toFixed(d).replace('.',',');  // lep prikaz z vejico
    const niceUp = (val)=>{ // zaokroži gor na 1–2–5 × 10^k (da so osi "lepe")
      const p = Math.pow(10, Math.floor(Math.log10(Math.max(1,val))));
      const r = val/p; const f = r<=1?1:r<=2?2:r<=5?5:10; return f*p;
    };

    // ========= DOM =========
    const axisLayer=document.getElementById('axis');
    const bike=document.getElementById('bike');
    const crank=document.getElementById('crank');
    const liveOut=document.getElementById('liveOut');
    const dOut=document.getElementById('dOut');
    const tOut=document.getElementById('tOut');
    const vOut=document.getElementById('vOut');

    const newBtn=document.getElementById('newBtn');
    const playBtn=document.getElementById('playBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const resetBtn=document.getElementById('resetBtn');

    const dataBody=document.getElementById('dataBody');

    // ========= Stanje aplikacije =========
    let D=10, T=5, v=2;
    let R=12; // dolžina vidnega tira (m), vedno > D
    const startX=60, endX=940; // os animacije
    let req=null, pausedAt=0, running=false; let lastElapsedSec=0;

    // mini efekt "flash"
    function flash(el){ el.classList.add('flash'); setTimeout(()=>el.classList.remove('flash'),300); }

    // ========= Tabela s(t) =========
    function buildTable(){
      dataBody.innerHTML='';
      for(let s=0; s<=T; s++){
        const tr=document.createElement('tr');
        const tdT=document.createElement('td'); tdT.className='time'; tdT.textContent=s.toString();
        const tdS=document.createElement('td'); tdS.className='dist'; tdS.id='d-'+s; tdS.textContent=(s===0?'0,0':'—');
        if(s===0){ tdS.classList.add('filled'); }
        tr.appendChild(tdT); tr.appendChild(tdS); dataBody.appendChild(tr);
      }
    }
    function fillTableUpTo(tNow){
      const upTo = Math.min(T, Math.floor(tNow));
      for(let s=1; s<=upTo; s++){
        const cell = document.getElementById('d-'+s);
        if(cell && !cell.classList.contains('filled')){
          const sMeters = (D/T) * s;
          cell.textContent = fmt(sMeters);
          cell.classList.add('filled');
        }
      }
    }
    function fillFinalIfNeeded(){
      const cell = document.getElementById('d-'+T);
      if(cell && !cell.classList.contains('filled')){
        cell.textContent = fmt(D);
        cell.classList.add('filled');
      }
    }

    // ========= Številčna os (SVG) =========
    function drawAxis(){
      axisLayer.innerHTML='';
      const line=(x1,y1,x2,y2,stroke='#cbd5e1',w=3)=>{
        const L=document.createElementNS('http://www.w3.org/2000/svg','line');
        L.setAttribute('x1',x1);L.setAttribute('y1',y1);L.setAttribute('x2',x2);L.setAttribute('y2',y2);
        L.setAttribute('stroke',stroke);L.setAttribute('stroke-width',w);axisLayer.appendChild(L)
      };
      const text=(x,y,t,fs=14,fill='#e5e7eb',weight='normal')=>{
        const el=document.createElementNS('http://www.w3.org/2000/svg','text');
        el.setAttribute('x',x);el.setAttribute('y',y);
        el.setAttribute('fill',fill);
        el.setAttribute('font-size',fs);
        el.setAttribute('font-weight',weight);
        el.setAttribute('text-anchor','middle');
        el.textContent=t;axisLayer.appendChild(el)
      };
      // glavna črta tira
      line(startX,155,endX,155,'#cbd5e1',3.5);

      // redne kljukice in oznake: od 0 do R (NE do D)
      const tickStep = R<=20?1:(R<=50?5:10);
      for(let m=0;m<=R;m+=tickStep){
        const x = startX + (m/R)*(endX-startX);
        line(x,150,x,165,'#94a3b8',2);
        if(m !== D){ text(x,190,String(m)); }
      }

      // posebna oznaka pri D (ustavitev) – debelejša, daljša in z rdečim napisom
      const xStop = startX + (D/R)*(endX-startX);
      line(xStop,146,xStop,170,'var(--stop)',4);
      text(xStop,140,`${D} m`,18,'var(--stop)','800');

      // enota (m)
      const unit=document.createElementNS('http://www.w3.org/2000/svg','text');
      unit.setAttribute('x',endX+24);unit.setAttribute('y',190);unit.setAttribute('fill','#e5e7eb');
      unit.setAttribute('font-size','14');unit.textContent='(m)';axisLayer.appendChild(unit);
    }

    function setBikeX(x){ bike.setAttribute('transform',`translate(${x},155)`) }

    // ========= Chart.js – priprava grafov =========
    let sChart, vChart;           // objekta grafov
    let XMAX_PAD, SMAX_PAD, VMAX_PAD;

    function computePaddedBounds(){
      XMAX_PAD = niceUp(T*1.10);
      SMAX_PAD = niceUp(D*1.10);
      VMAX_PAD = niceUp((D/T)*1.30);
    }

    function makeCharts(){
      computePaddedBounds();

      const grid = 'rgba(148,163,184,0.35)';
      const label = '#e5e7eb';

      const baseScales = (xMax, yMax, xLabel, yLabel)=>({
        x: {
          type: 'linear',
          min: 0,
          suggestedMax: xMax,
          grid: { color: grid, drawTicks: true, drawBorder: true, lineWidth: 1.2 },
          ticks: { color: label, stepSize: 1 },
          title: { display: true, text: xLabel, color: '#94a3b8' }
        },
        y: {
          min: 0,
          suggestedMax: yMax,
          grid: { color: grid, drawTicks: true, drawBorder: true, lineWidth: 1.2 },
          ticks: { color: label },
          title: { display: true, text: yLabel, color: '#94a3b8' }
        }
      });

      // s(t)
      sChart = new Chart(document.getElementById('sChart').getContext('2d'),{
        type:'line',
        data:{datasets:[{label:'s(t)',data:[{x:0,y:0}],tension:0,pointRadius:3,borderWidth:2}]},
        options:{ animation:false, responsive:true, scales: baseScales(XMAX_PAD,SMAX_PAD,'t [s]','s [m]'), plugins:{legend:{display:false}} }
      });

      // v(t)
      vChart = new Chart(document.getElementById('vChart').getContext('2d'),{
        type:'line',
        data:{datasets:[{label:'v(t)',data:[{x:0,y:D/T}],tension:0,pointRadius:3,borderWidth:2}]},
        options:{ animation:false, responsive:true, scales: baseScales(XMAX_PAD,VMAX_PAD,'t [s]','v [m/s]'), plugins:{legend:{display:false}} }
      });
    }

    function updateCharts(tNow){
      const sNow = (D/T)*tNow;
      sChart.data.datasets[0].data = [{x:0,y:0},{x:tNow,y:sNow}];
      vChart.data.datasets[0].data = [{x:0,y:D/T},{x:tNow,y:D/T}];

      if(tNow > XMAX_PAD*0.98){ XMAX_PAD = niceUp(tNow*1.15); sChart.options.scales.x.suggestedMax = XMAX_PAD; vChart.options.scales.x.suggestedMax = XMAX_PAD; }
      if(sNow > SMAX_PAD*0.98){ SMAX_PAD = niceUp(sNow*1.20); sChart.options.scales.y.suggestedMax = SMAX_PAD; }
      if((D/T) > VMAX_PAD*0.98){ VMAX_PAD = niceUp((D/T)*1.30); vChart.options.scales.y.suggestedMax = VMAX_PAD; }

      sChart.update('none');
      vChart.update('none');
    }

    // ========= Nova naloga / reset =========
    function newTask(){
      D = rndInt(1,100);
      T = rndInt(2,20);
      v = D / T;
      const extra = Math.max(5, Math.round(D*0.15));
      R = niceUp(D + extra);
      dOut.textContent = `${D} m`;
      tOut.textContent = `${T} s`;
      vOut.textContent = `${(Math.round(v*100)/100).toString().replace('.', ',')} m/s`;
      flash(dOut); flash(tOut); flash(vOut);
      drawAxis();
      reset();
    }

    function reset(){
      cancelAnim();
      running=false; pausedAt=0;
      setBikeX(startX);
      // reset crank rotation
      crank.setAttribute('transform','rotate(0 20 0)');
      liveOut.textContent = `0,0 m / 0,0 s`;
      playBtn.textContent='Predvajaj';

      buildTable();

      if(sChart){ sChart.destroy(); } if(vChart){ vChart.destroy(); }
      makeCharts();
      updateCharts(0);
    }

    function cancelAnim(){ if(req){ cancelAnimationFrame(req); req=null; } }

    // ========= Animacija =========
    function play(){
      if(running) return;
      running=true;
      playBtn.textContent='Teče…';

      const duration = T*1000;
      const startStamp = performance.now() - pausedAt;

      const loop=(now)=>{
        if(!running) return;
        const elapsed = Math.min(now - startStamp, duration);
        const p = elapsed/duration;
        const sNow = p * D;
        const x = startX + (sNow / R) * (endX - startX);
        setBikeX(x);

        // simple pedal spin tied to time (not to wheel size)
        const tNow = elapsed/1000;
        const spinDeg = (tNow * 360) % 360; // 1 rev/s visually pleasant
        crank.setAttribute('transform', `rotate(${spinDeg} 20 0)`);

        liveOut.textContent = `${fmt(sNow)} m / ${fmt(tNow)} s`;
        lastElapsedSec = tNow;

        updateCharts(tNow);
        fillTableUpTo(tNow);

        if(elapsed>=duration){
          running=false;
          playBtn.textContent='Ponovi';
          pausedAt=duration;
          fillFinalIfNeeded(); // s(T)=D
          return;
        }
        req=requestAnimationFrame(loop);
      };
      req=requestAnimationFrame(loop);
    }

    function pause(){
      if(!running) return;
      running=false;
      playBtn.textContent='Nadaljuj';
      pausedAt = Math.max(0, Math.min(T, lastElapsedSec)) * 1000;
      cancelAnim();
    }

    // ========= Gumbi =========
    newBtn.addEventListener('click', newTask);
    playBtn.addEventListener('click', ()=>{
      if(pausedAt>=T*1000){ reset(); play(); } else { play(); }
    });
    pauseBtn.addEventListener('click', pause);
    resetBtn.addEventListener('click', reset);

    // ========= Prvi zagon =========
    drawAxis();
    newTask(); // takoj en primer
  </script>
</body>
</html>
